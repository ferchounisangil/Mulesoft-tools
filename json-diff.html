<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JSON Diff</title>
  <style>
    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #22263a;
      --border: #2e3350;
      --accent: #4f8ef7;
      --accent-hover: #3a7ae0;
      --success: #3ecf8e;
      --error: #f56565;
      --warning: #f6ad55;
      --text: #e2e8f0;
      --text-muted: #8892a4;
      --radius: 10px;
      --font-mono: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;

      --diff-added-bg:    rgba(62, 207, 142, 0.10);
      --diff-added-border:   #3ecf8e;
      --diff-removed-bg: rgba(245, 101, 101, 0.10);
      --diff-removed-border: #f56565;
      --diff-changed-bg: rgba(246, 173, 85, 0.10);
      --diff-changed-border: #f6ad55;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32px 16px;
    }

    header {
      width: 100%;
      max-width: 1300px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 36px; height: 36px;
      background: var(--accent);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }

    header h1 { font-size: 18px; font-weight: 600; letter-spacing: -0.3px; }
    header span { font-size: 13px; color: var(--text-muted); margin-left: 4px; }

    /* â”€â”€ LEGEND â”€â”€ */
    .legend {
      width: 100%;
      max-width: 1300px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .legend-item {
      display: flex; align-items: center; gap: 8px;
      font-size: 12px; color: var(--text-muted);
    }
    .legend-dot {
      width: 12px; height: 12px; border-radius: 3px; flex-shrink: 0;
    }
    .dot-changed  { background: var(--warning); }
    .dot-added    { background: var(--success); }
    .dot-removed  { background: var(--error); }
    .dot-equal    { background: var(--border); }

    /* â”€â”€ INPUTS â”€â”€ */
    .workspace {
      width: 100%;
      max-width: 1300px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 820px) { .workspace { grid-template-columns: 1fr; } }

    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      display: flex; flex-direction: column;
      overflow: hidden;
    }

    .panel-header {
      padding: 12px 16px;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
    }

    .panel-title {
      font-size: 12px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.8px;
      color: var(--text-muted);
    }

    .badge {
      font-size: 11px; padding: 2px 8px;
      border-radius: 20px; font-weight: 500;
    }
    .badge-a { background: #2a2f4a; color: var(--accent); }
    .badge-b { background: #2a3a2a; color: var(--success); }

    textarea {
      flex: 1; background: transparent; border: none; outline: none;
      resize: none; color: var(--text);
      font-family: var(--font-mono); font-size: 12.5px; line-height: 1.7;
      padding: 16px; min-height: 300px;
    }
    textarea::placeholder { color: var(--text-muted); }
    textarea:focus { background: rgba(79,142,247,0.03); }

    /* â”€â”€ ACTIONS â”€â”€ */
    .actions {
      width: 100%; max-width: 1300px;
      display: flex; gap: 12px;
      margin: 16px 0; flex-wrap: wrap; align-items: center;
    }

    button {
      border: none; cursor: pointer; border-radius: 8px;
      font-size: 13px; font-weight: 600; padding: 10px 22px;
      transition: all .15s ease;
      display: flex; align-items: center; gap: 7px;
    }
    .btn-primary  { background: var(--accent); color: #fff; }
    .btn-primary:hover { background: var(--accent-hover); transform: translateY(-1px); }
    .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--border); }
    .btn-danger   { background: transparent; color: var(--error); border: 1px solid var(--error); }
    .btn-danger:hover { background: rgba(245,101,101,0.1); }

    .status {
      margin-left: auto; font-size: 12px; color: var(--text-muted);
      display: flex; align-items: center; gap: 6px;
    }
    .status-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--text-muted); }
    .status-dot.ok      { background: var(--success); }
    .status-dot.err     { background: var(--error); }
    .status-dot.waiting { background: var(--warning); }

    /* â”€â”€ SUMMARY PILLS â”€â”€ */
    .summary-bar {
      width: 100%; max-width: 1300px;
      display: none;
      gap: 10px; flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .summary-bar.visible { display: flex; }
    .pill {
      font-size: 12px; font-weight: 600;
      padding: 5px 14px; border-radius: 20px;
      display: flex; align-items: center; gap: 6px;
    }
    .pill-changed  { background: rgba(246,173,85,0.15);  color: var(--warning);  border: 1px solid rgba(246,173,85,0.3); }
    .pill-added    { background: rgba(62,207,142,0.12);  color: var(--success);  border: 1px solid rgba(62,207,142,0.3); }
    .pill-removed  { background: rgba(245,101,101,0.12); color: var(--error);    border: 1px solid rgba(245,101,101,0.3); }
    .pill-equal    { background: rgba(79,142,247,0.10);  color: var(--accent);   border: 1px solid rgba(79,142,247,0.25); }

    /* â”€â”€ DIFF OUTPUT â”€â”€ */
    .diff-container {
      width: 100%; max-width: 1300px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      display: none;
    }
    .diff-container.visible { display: block; }

    .diff-table-header {
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
    }
    .diff-table-header > div {
      padding: 11px 18px;
      font-size: 12px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-muted);
    }
    .diff-table-header > div:first-child { border-right: 1px solid var(--border); }

    /* scroll sync wrapper */
    .diff-scroll {
      overflow-y: auto;
      max-height: 620px;
    }

    .diff-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      border-bottom: 1px solid rgba(46,51,80,0.5);
      transition: background .1s;
    }
    .diff-row:last-child { border-bottom: none; }
    .diff-row:hover { background: rgba(79,142,247,0.04); }

    .diff-cell {
      padding: 6px 18px;
      font-family: var(--font-mono);
      font-size: 12px; line-height: 1.7;
      white-space: pre-wrap; word-break: break-all;
      position: relative;
    }
    .diff-cell:first-child { border-right: 1px solid var(--border); }

    /* States */
    .diff-row.changed .diff-cell:first-child  { background: var(--diff-removed-bg); border-left: 3px solid var(--diff-removed-border); }
    .diff-row.changed .diff-cell:last-child   { background: var(--diff-changed-bg);  border-left: 3px solid var(--diff-changed-border); }
    .diff-row.added   .diff-cell              { background: var(--diff-added-bg);    border-left: 3px solid var(--diff-added-border); }
    .diff-row.removed .diff-cell              { background: var(--diff-removed-bg);  border-left: 3px solid var(--diff-removed-border); }

    .key-label {
      color: #79b8ff;
      font-weight: 600;
    }
    .val-str   { color: #9ecbff; }
    .val-num   { color: #f8c555; }
    .val-bool  { color: #f97583; }
    .val-null  { color: #f97583; font-style: italic; }
    .val-obj   { color: var(--text-muted); font-style: italic; }

    .diff-tag {
      display: inline-block;
      font-size: 10px; font-weight: 700;
      padding: 1px 6px; border-radius: 4px;
      vertical-align: middle; margin-left: 6px;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .tag-changed { background: rgba(246,173,85,0.2);  color: var(--warning); }
    .tag-added   { background: rgba(62,207,142,0.2);  color: var(--success); }
    .tag-removed { background: rgba(245,101,101,0.2); color: var(--error); }

    /* empty / identical */
    .diff-empty {
      padding: 40px;
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
    }
    .diff-empty .big-icon { font-size: 40px; display: block; margin-bottom: 12px; }

    /* â”€â”€ TOAST â”€â”€ */
    .toast {
      position: fixed; bottom: 28px; right: 28px;
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 12px 18px;
      font-size: 13px; display: flex; align-items: center; gap: 8px;
      opacity: 0; transform: translateY(12px); transition: all .25s ease;
      pointer-events: none; z-index: 999;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.ok   { border-color: var(--success); color: var(--success); }
    .toast.err  { border-color: var(--error);   color: var(--error); }
    .toast.warn { border-color: var(--warning);  color: var(--warning); }

    /* filter bar */
    .filter-bar {
      width: 100%; max-width: 1300px;
      display: none; gap: 8px; flex-wrap: wrap;
      margin-bottom: 10px; align-items: center;
    }
    .filter-bar.visible { display: flex; }
    .filter-label { font-size: 12px; color: var(--text-muted); }
    .filter-btn {
      padding: 5px 13px; font-size: 12px; font-weight: 600;
      border-radius: 20px; border: 1px solid var(--border);
      background: var(--surface2); color: var(--text-muted); cursor: pointer;
      transition: all .15s;
    }
    .filter-btn.active-all      { border-color: var(--accent);   color: var(--accent);   background: rgba(79,142,247,0.1); }
    .filter-btn.active-changed  { border-color: var(--warning);  color: var(--warning);  background: rgba(246,173,85,0.1); }
    .filter-btn.active-added    { border-color: var(--success);  color: var(--success);  background: rgba(62,207,142,0.1); }
    .filter-btn.active-removed  { border-color: var(--error);    color: var(--error);    background: rgba(245,101,101,0.1); }
    .filter-btn.active-equal    { border-color: var(--text-muted); color: var(--text); background: rgba(136,146,164,0.1); }

    .search-box {
      margin-left: auto;
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; padding: 5px 12px;
      color: var(--text); font-size: 12px; outline: none;
      width: 200px;
    }
    .search-box::placeholder { color: var(--text-muted); }
    .search-box:focus { border-color: var(--accent); }

    .highlight-match { background: rgba(246,173,85,0.35); border-radius: 2px; }
  </style>
</head>
<body>

<header>
  <div class="logo">ğŸ”</div>
  <div>
    <h1>JSON Diff <span>â€” MuleSoft Tools</span></h1>
  </div>
</header>

<!-- LEGEND -->
<div class="legend">
  <div class="legend-item"><div class="legend-dot dot-changed"></div> Valor modificado</div>
  <div class="legend-item"><div class="legend-dot dot-added"></div> Campo agregado en B</div>
  <div class="legend-item"><div class="legend-dot dot-removed"></div> Campo eliminado (solo en A)</div>
  <div class="legend-item"><div class="legend-dot dot-equal"></div> Igual</div>
</div>

<!-- INPUT PANELS -->
<div class="workspace">
  <div class="panel">
    <div class="panel-header">
      <span class="panel-title">JSON A (base)</span>
      <span class="badge badge-a">Original</span>
    </div>
    <textarea id="jsonA" spellcheck="false"
      placeholder='Pega aquÃ­ el JSON A (base / referencia)&#10;&#10;Ejemplo:&#10;{&#10;  "nombre": "Luis",&#10;  "rol": "dev"&#10;}'></textarea>
  </div>
  <div class="panel">
    <div class="panel-header">
      <span class="panel-title">JSON B (comparar)</span>
      <span class="badge badge-b">Comparado</span>
    </div>
    <textarea id="jsonB" spellcheck="false"
      placeholder='Pega aquÃ­ el JSON B (el que quieres comparar contra A)&#10;&#10;Ejemplo:&#10;{&#10;  "nombre": "Luis",&#10;  "rol": "lead"&#10;}'></textarea>
  </div>
</div>

<!-- ACTIONS -->
<div class="actions">
  <button class="btn-primary" onclick="comparar()">ğŸ” Comparar JSONs</button>
  <button class="btn-secondary" onclick="intercambiar()">â†•ï¸ Intercambiar A â†” B</button>
  <button class="btn-danger" onclick="limpiar()">ğŸ—‘ Limpiar todo</button>
  <div class="status">
    <div class="status-dot waiting" id="status-dot"></div>
    <span id="status-text">Esperando JSONsâ€¦</span>
  </div>
</div>

<!-- SUMMARY PILLS -->
<div class="summary-bar" id="summary-bar">
  <span class="pill pill-changed" id="pill-changed">âš¡ 0 modificados</span>
  <span class="pill pill-added"   id="pill-added">âœš 0 agregados</span>
  <span class="pill pill-removed" id="pill-removed">âœ– 0 eliminados</span>
  <span class="pill pill-equal"   id="pill-equal">âœ” 0 iguales</span>
</div>

<!-- FILTER BAR -->
<div class="filter-bar" id="filter-bar">
  <span class="filter-label">Filtrar:</span>
  <button class="filter-btn active-all" data-filter="all"     onclick="setFilter('all')">Todos</button>
  <button class="filter-btn"           data-filter="changed"  onclick="setFilter('changed')">Modificados</button>
  <button class="filter-btn"           data-filter="added"    onclick="setFilter('added')">Agregados</button>
  <button class="filter-btn"           data-filter="removed"  onclick="setFilter('removed')">Eliminados</button>
  <button class="filter-btn"           data-filter="equal"    onclick="setFilter('equal')">Iguales</button>
  <input class="search-box" id="search-box" type="text" placeholder="ğŸ” Buscar campoâ€¦" oninput="applySearch()" />
</div>

<!-- DIFF RESULT -->
<div class="diff-container" id="diff-container">
  <div class="diff-table-header">
    <div>ğŸ…° JSON A â€” Base</div>
    <div>ğŸ…± JSON B â€” Comparado</div>
  </div>
  <div class="diff-scroll" id="diff-body"></div>
</div>

<div class="toast" id="toast"></div>

<script>
  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  function parseJSON(str) {
    str = str.trim();
    if (!str) throw new Error('Campo vacÃ­o');
    return JSON.parse(str);
  }

  function formatVal(val) {
    if (val === null)                          return { html: '<span class="val-null">null</span>',      text: 'null' };
    if (typeof val === 'boolean')              return { html: '<span class="val-bool">' + val + '</span>', text: String(val) };
    if (typeof val === 'number')               return { html: '<span class="val-num">'  + val + '</span>', text: String(val) };
    if (typeof val === 'string')               return { html: '<span class="val-str">"' + esc(val) + '"</span>', text: '"' + val + '"' };
    if (Array.isArray(val))                    return { html: '<span class="val-obj">[Array Â· ' + val.length + ' items]</span>', text: JSON.stringify(val) };
    if (typeof val === 'object')               return { html: '<span class="val-obj">{Object Â· ' + Object.keys(val).length + ' keys}</span>', text: JSON.stringify(val) };
    return { html: esc(String(val)), text: String(val) };
  }

  function esc(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DIFF ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  /**
   * Compara recursivamente obj A vs B.
   * Retorna array de { path, status, valA, valB }
   * status: 'equal' | 'changed' | 'added' | 'removed'
   */
  function diffObjects(a, b, path) {
    path = path || '';
    const results = [];

    const isObj = v => v !== null && typeof v === 'object' && !Array.isArray(v);
    const isArr = v => Array.isArray(v);

    const keysA = isObj(a) ? Object.keys(a) : [];
    const keysB = isObj(b) ? Object.keys(b) : [];
    const allKeys = [...new Set([...keysA, ...keysB])];

    if (isObj(a) && isObj(b)) {
      for (const key of allKeys) {
        const fullPath = path ? path + '.' + key : key;
        const hasA = Object.prototype.hasOwnProperty.call(a, key);
        const hasB = Object.prototype.hasOwnProperty.call(b, key);

        if (!hasA) {
          results.push({ path: fullPath, status: 'added',   valA: undefined, valB: b[key] });
        } else if (!hasB) {
          results.push({ path: fullPath, status: 'removed', valA: a[key],    valB: undefined });
        } else if (isObj(a[key]) && isObj(b[key])) {
          // Recurse into nested objects
          results.push(...diffObjects(a[key], b[key], fullPath));
        } else if (isArr(a[key]) && isArr(b[key])) {
          // Compare arrays item by item
          results.push(...diffArrays(a[key], b[key], fullPath));
        } else if (JSON.stringify(a[key]) !== JSON.stringify(b[key])) {
          results.push({ path: fullPath, status: 'changed', valA: a[key],    valB: b[key] });
        } else {
          results.push({ path: fullPath, status: 'equal',   valA: a[key],    valB: b[key] });
        }
      }
    } else if (isArr(a) && isArr(b)) {
      results.push(...diffArrays(a, b, path));
    } else {
      const status = JSON.stringify(a) === JSON.stringify(b) ? 'equal' : 'changed';
      results.push({ path: path || '(raÃ­z)', status, valA: a, valB: b });
    }

    return results;
  }

  function diffArrays(arrA, arrB, path) {
    const results = [];
    const len = Math.max(arrA.length, arrB.length);
    for (let i = 0; i < len; i++) {
      const fullPath = path + '[' + i + ']';
      if (i >= arrA.length) {
        results.push({ path: fullPath, status: 'added',   valA: undefined, valB: arrB[i] });
      } else if (i >= arrB.length) {
        results.push({ path: fullPath, status: 'removed', valA: arrA[i],   valB: undefined });
      } else {
        const isObj = v => v !== null && typeof v === 'object';
        if (isObj(arrA[i]) && isObj(arrB[i])) {
          results.push(...diffObjects(arrA[i], arrB[i], fullPath));
        } else if (JSON.stringify(arrA[i]) !== JSON.stringify(arrB[i])) {
          results.push({ path: fullPath, status: 'changed', valA: arrA[i], valB: arrB[i] });
        } else {
          results.push({ path: fullPath, status: 'equal',   valA: arrA[i], valB: arrB[i] });
        }
      }
    }
    return results;
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  let allRows = [];
  let activeFilter = 'all';

  function buildRow(item) {
    const { path, status, valA, valB } = item;

    const depth = (path.match(/\./g) || []).length + (path.match(/\[/g) || []).length;
    const indent = '  '.repeat(depth);
    const keyPart = path.split(/\.|\[/).pop().replace(']', '');

    const fA = valA !== undefined ? formatVal(valA) : null;
    const fB = valB !== undefined ? formatVal(valB) : null;

    let tagA = '', tagB = '';
    if (status === 'changed') { tagA = '<span class="diff-tag tag-changed">antes</span>'; tagB = '<span class="diff-tag tag-changed">ahora</span>'; }
    if (status === 'added')   { tagB = '<span class="diff-tag tag-added">nuevo</span>'; }
    if (status === 'removed') { tagA = '<span class="diff-tag tag-removed">eliminado</span>'; }

    const cellA = fA
      ? indent + '<span class="key-label">' + esc(keyPart) + '</span>: ' + fA.html + tagA
      : '<span style="color:var(--text-muted);font-style:italic">' + indent + esc(keyPart) + ': â€”</span>';

    const cellB = fB
      ? indent + '<span class="key-label">' + esc(keyPart) + '</span>: ' + fB.html + tagB
      : '<span style="color:var(--text-muted);font-style:italic">' + indent + esc(keyPart) + ': â€”</span>';

    const div = document.createElement('div');
    div.className = 'diff-row ' + status;
    div.dataset.status = status;
    div.dataset.path = path.toLowerCase();
    div.innerHTML = '<div class="diff-cell">' + cellA + '</div><div class="diff-cell">' + cellB + '</div>';
    return div;
  }

  function renderDiff(items) {
    const body = document.getElementById('diff-body');
    body.innerHTML = '';
    allRows = [];

    if (items.length === 0) {
      body.innerHTML = '<div class="diff-empty"><span class="big-icon">âœ…</span>Los JSONs son idÃ©nticos â€” no hay diferencias.</div>';
      return;
    }

    items.forEach(item => {
      const row = buildRow(item);
      allRows.push(row);
      body.appendChild(row);
    });
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FILTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  function setFilter(f) {
    activeFilter = f;
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.className = 'filter-btn' + (btn.dataset.filter === f ? ' active-' + f : '');
    });
    applySearch();
  }

  function applySearch() {
    const q = (document.getElementById('search-box').value || '').toLowerCase();
    allRows.forEach(row => {
      const matchFilter = activeFilter === 'all' || row.dataset.status === activeFilter;
      const matchSearch = !q || row.dataset.path.includes(q);
      row.style.display = (matchFilter && matchSearch) ? '' : 'none';
    });
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  function comparar() {
    const rawA = document.getElementById('jsonA').value;
    const rawB = document.getElementById('jsonB').value;

    let a, b;
    try { a = parseJSON(rawA); } catch(e) {
      setStatus('err', 'JSON A invÃ¡lido');
      toast('âŒ JSON A invÃ¡lido: ' + e.message, 'err'); return;
    }
    try { b = parseJSON(rawB); } catch(e) {
      setStatus('err', 'JSON B invÃ¡lido');
      toast('âŒ JSON B invÃ¡lido: ' + e.message, 'err'); return;
    }

    const items = diffObjects(a, b);
    renderDiff(items);

    // Conteos
    const counts = { changed: 0, added: 0, removed: 0, equal: 0 };
    items.forEach(i => counts[i.status]++);

    document.getElementById('pill-changed').textContent = 'âš¡ ' + counts.changed + ' modificado' + (counts.changed !== 1 ? 's' : '');
    document.getElementById('pill-added').textContent   = 'âœš ' + counts.added   + ' agregado'   + (counts.added   !== 1 ? 's' : '');
    document.getElementById('pill-removed').textContent = 'âœ– ' + counts.removed + ' eliminado'  + (counts.removed !== 1 ? 's' : '');
    document.getElementById('pill-equal').textContent   = 'âœ” ' + counts.equal   + ' igual'      + (counts.equal   !== 1 ? 'es' : '');

    document.getElementById('summary-bar').classList.add('visible');
    document.getElementById('filter-bar').classList.add('visible');
    document.getElementById('diff-container').classList.add('visible');

    // Reset filter
    setFilter('all');

    const total = counts.changed + counts.added + counts.removed;
    if (total === 0) {
      setStatus('ok', 'âœ“ JSONs idÃ©nticos');
      toast('âœ… Los JSONs son idÃ©nticos', 'ok');
    } else {
      setStatus('err', total + ' diferencia' + (total !== 1 ? 's' : '') + ' encontrada' + (total !== 1 ? 's' : ''));
      toast('âš¡ ' + total + ' diferencia' + (total !== 1 ? 's' : '') + ' encontrada' + (total !== 1 ? 's' : ''), 'warn');
    }
  }

  function intercambiar() {
    const a = document.getElementById('jsonA').value;
    const b = document.getElementById('jsonB').value;
    document.getElementById('jsonA').value = b;
    document.getElementById('jsonB').value = a;
    toast('â†•ï¸ JSONs intercambiados', 'ok');
  }

  function limpiar() {
    document.getElementById('jsonA').value = '';
    document.getElementById('jsonB').value = '';
    document.getElementById('diff-body').innerHTML = '';
    document.getElementById('summary-bar').classList.remove('visible');
    document.getElementById('filter-bar').classList.remove('visible');
    document.getElementById('diff-container').classList.remove('visible');
    document.getElementById('search-box').value = '';
    allRows = [];
    activeFilter = 'all';
    setStatus('waiting', 'Esperando JSONsâ€¦');
  }

  function setStatus(tipo, texto) {
    document.getElementById('status-dot').className = 'status-dot ' + tipo;
    document.getElementById('status-text').textContent = texto;
  }

  function toast(msg, tipo) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast ' + tipo + ' show';
    clearTimeout(t._timer);
    t._timer = setTimeout(() => { t.className = 'toast'; }, 3000);
  }

  // Ctrl+Enter para comparar
  document.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') comparar();
  });
</script>
</body>
</html>
